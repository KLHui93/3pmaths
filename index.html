<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乘法竞赛游戏</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for a clean look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons (play/pause, volume) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a8c0ff, #3f2b96); /* 渐变背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #fff;
            overflow-x: hidden; /* 防止水平滚动 */
        }

        .game-container {
            background-color: rgba(255, 255, 255, 0.1); /* 半透明背景 */
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            backdrop-filter: blur(10px); /* 磨砂玻璃效果 */
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }

        .player-card {
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            flex: 1; /* 让玩家卡片在 flex 容器中均匀分布 */
            min-width: 280px; /* 最小宽度，防止过小 */
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }

        .keyboard-button {
            background-color: rgba(255, 255, 255, 0.25);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            flex: 1; /* 让按钮在 flex 容器中均匀分布 */
            min-width: 60px; /* 确保按钮不会太窄 */
            height: 60px; /* 统一按钮高度 */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .keyboard-button:hover {
            background-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .keyboard-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .submit-button {
            background: linear-gradient(45deg, #4CAF50, #8BC34A); /* 提交按钮渐变色 */
            font-size: 1.2rem;
            padding: 12px 25px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .submit-button:hover {
            background: linear-gradient(45deg, #5cb85c, #9ccc65);
        }

        .start-button {
            background: linear-gradient(45deg, #007bff, #00c6ff); /* 开始按钮渐变色 */
            font-size: 1.5rem;
            padding: 15px 35px;
            border-radius: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            margin-top: 20px;
        }

        .start-button:hover {
            background: linear-gradient(45deg, #0056b3, #0099e6);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, #6a11cb, #2575fc); /* 模态框渐变背景 */
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            text-align: center;
            color: #fff;
            max-width: 500px;
            width: 90%;
            transform: translateY(-50px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        /* 答案反馈动画 */
        .correct-feedback {
            background-color: rgba(76, 175, 80, 0.7); /* 绿色 */
            animation: flashGreen 0.3s ease-out;
        }

        .wrong-feedback {
            background-color: rgba(244, 67, 54, 0.7); /* 红色 */
            animation: flashRed 0.3s ease-out;
        }

        @keyframes flashGreen {
            0% { background-color: transparent; }
            50% { background-color: rgba(76, 175, 80, 0.7); }
            100% { background-color: transparent; }
        }

        @keyframes flashRed {
            0% { background-color: transparent; }
            50% { background-color: rgba(244, 67, 54, 0.7); }
            100% { background-color: transparent; }
        }

        /* 确保输入框在移动设备上足够大 */
        input[type="text"] {
            -webkit-appearance: none; /* 移除 iOS 默认样式 */
            -moz-appearance: none; /* 移除 Firefox 默认样式 */
            appearance: none;
            padding: 12px;
            font-size: 1.5rem;
            text-align: center;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            background-color: rgba(0, 0, 0, 0.2);
            color: #fff;
            outline: none;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus {
            border-color: #00c6ff;
        }

        /* 音频控制样式 */
        .audio-controls {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px 25px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            width: fit-content;
            margin-bottom: 20px;
        }

        .audio-controls button {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.8rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .audio-controls button:hover {
            transform: scale(1.1);
        }

        .audio-controls input[type="range"] {
            -webkit-appearance: none;
            width: 150px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            outline: none;
            transition: opacity .2s;
        }

        .audio-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00c6ff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .audio-controls input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00c6ff;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* 响应式布局调整 */
        @media (max-width: 1024px) {
            .player-sections {
                flex-direction: column;
                gap: 20px;
            }
            .player-card {
                width: 100%;
                max-width: 400px; /* 限制在小屏幕上的最大宽度 */
            }
            .game-container {
                padding: 20px;
            }
            .audio-controls {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 15px;
            }
            .player-card {
                padding: 15px;
            }
            .keyboard-button {
                padding: 10px;
                font-size: 1.2rem;
                min-width: 50px;
                height: 50px;
            }
            .submit-button, .start-button {
                font-size: 1rem;
                padding: 10px 20px;
            }
            h1 {
                font-size: 2rem;
            }
            .timer {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="text-4xl md:text-5xl font-bold mb-4 text-shadow-lg text-center">乘法竞赛游戏</h1>

        <!-- 实时倒计时 -->
        <div class="timer text-6xl md:text-7xl font-extrabold mb-6 text-yellow-300 drop-shadow-lg">02:00</div>

        <!-- 背景音乐控制 -->
        <div class="audio-controls">
            <button id="playPauseBtn" class="focus:outline-none">
                <i class="fas fa-play" id="playIcon"></i>
                <i class="fas fa-pause hidden" id="pauseIcon"></i>
            </button>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
            <audio id="backgroundMusic" loop>
                <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
                您的浏览器不支持音频元素。
            </audio>
        </div>

        <!-- 玩家区域 -->
        <div class="player-sections flex flex-col md:flex-row justify-around w-full gap-5">
            <!-- 玩家 1 -->
            <div id="player1" class="player-card">
                <h2 class="text-2xl font-semibold">玩家 1</h2>
                <div class="score text-3xl font-bold text-green-300">分数: 0</div>
                <div class="question text-4xl font-bold mt-3 mb-4">? x ? =</div>
                <input type="text" class="answer-input w-full max-w-xs text-center" placeholder="输入答案" readonly>
                <div class="keyboard grid grid-cols-3 gap-2 w-full max-w-xs mt-4">
                    <!-- 数字键 -->
                    <button class="keyboard-button" data-value="7">7</button>
                    <button class="keyboard-button" data-value="8">8</button>
                    <button class="keyboard-button" data-value="9">9</button>
                    <button class="keyboard-button" data-value="4">4</button>
                    <button class="keyboard-button" data-value="5">5</button>
                    <button class="keyboard-button" data-value="6">6</button>
                    <button class="keyboard-button" data-value="1">1</button>
                    <button class="keyboard-button" data-value="2">2</button>
                    <button class="keyboard-button" data-value="3">3</button>
                    <button class="keyboard-button" data-value="0">0</button>
                    <button class="keyboard-button" data-action="backspace"><i class="fas fa-backspace"></i></button>
                    <button class="keyboard-button" data-action="clear">C</button>
                </div>
                <button class="submit-button mt-4 px-8 py-3 rounded-full text-white font-bold transition-all duration-300 ease-in-out">提交答案</button>
            </div>

            <!-- 玩家 2 -->
            <div id="player2" class="player-card">
                <h2 class="text-2xl font-semibold">玩家 2</h2>
                <div class="score text-3xl font-bold text-green-300">分数: 0</div>
                <div class="question text-4xl font-bold mt-3 mb-4">? x ? =</div>
                <input type="text" class="answer-input w-full max-w-xs text-center" placeholder="输入答案" readonly>
                <div class="keyboard grid grid-cols-3 gap-2 w-full max-w-xs mt-4">
                    <button class="keyboard-button" data-value="7">7</button>
                    <button class="keyboard-button" data-value="8">8</button>
                    <button class="keyboard-button" data-value="9">9</button>
                    <button class="keyboard-button" data-value="4">4</button>
                    <button class="keyboard-button" data-value="5">5</button>
                    <button class="keyboard-button" data-value="6">6</button>
                    <button class="keyboard-button" data-value="1">1</button>
                    <button class="keyboard-button" data-value="2">2</button>
                    <button class="keyboard-button" data-value="3">3</button>
                    <button class="keyboard-button" data-value="0">0</button>
                    <button class="keyboard-button" data-action="backspace"><i class="fas fa-backspace"></i></button>
                    <button class="keyboard-button" data-action="clear">C</button>
                </div>
                <button class="submit-button mt-4 px-8 py-3 rounded-full text-white font-bold transition-all duration-300 ease-in-out">提交答案</button>
            </div>

            <!-- 玩家 3 -->
            <div id="player3" class="player-card">
                <h2 class="text-2xl font-semibold">玩家 3</h2>
                <div class="score text-3xl font-bold text-green-300">分数: 0</div>
                <div class="question text-4xl font-bold mt-3 mb-4">? x ? =</div>
                <input type="text" class="answer-input w-full max-w-xs text-center" placeholder="输入答案" readonly>
                <div class="keyboard grid grid-cols-3 gap-2 w-full max-w-xs mt-4">
                    <button class="keyboard-button" data-value="7">7</button>
                    <button class="keyboard-button" data-value="8">8</button>
                    <button class="keyboard-button" data-value="9">9</button>
                    <button class="keyboard-button" data-value="4">4</button>
                    <button class="keyboard-button" data-value="5">5</button>
                    <button class="keyboard-button" data-value="6">6</button>
                    <button class="keyboard-button" data-value="1">1</button>
                    <button class="keyboard-button" data-value="2">2</button>
                    <button class="keyboard-button" data-value="3">3</button>
                    <button class="keyboard-button" data-value="0">0</button>
                    <button class="keyboard-button" data-action="backspace"><i class="fas fa-backspace"></i></button>
                    <button class="keyboard-button" data-action="clear">C</button>
                </div>
                <button class="submit-button mt-4 px-8 py-3 rounded-full text-white font-bold transition-all duration-300 ease-in-out">提交答案</button>
            </div>
        </div>

        <!-- 开始新游戏按钮 -->
        <button id="startGameBtn" class="start-button text-white font-bold transition-all duration-300 ease-in-out">开始新游戏</button>
    </div>

    <!-- 游戏结束弹窗 -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <h2 class="text-4xl font-bold mb-4">游戏结束！</h2>
            <div id="modalMessage" class="text-2xl mb-6"></div>
            <button id="playAgainBtn" class="submit-button px-8 py-3 rounded-full text-white font-bold transition-all duration-300 ease-in-out">再玩一次</button>
        </div>
    </div>

    <script>
        // 获取 DOM 元素
        const timerDisplay = document.querySelector('.timer');
        const playerCards = document.querySelectorAll('.player-card');
        const startGameBtn = document.getElementById('startGameBtn');
        const gameOverModal = document.getElementById('gameOverModal');
        const modalMessage = document.getElementById('modalMessage');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const volumeSlider = document.getElementById('volumeSlider');

        // 游戏状态变量
        let gameActive = false;
        let timeLeft = 120; // 2分钟 = 120秒
        let timerInterval;
        const players = [];

        // 初始化玩家数据
        for (let i = 0; i < playerCards.length; i++) {
            const playerCard = playerCards[i];
            players.push({
                id: `player${i + 1}`,
                score: 0,
                question: { num1: 0, num2: 0, answer: 0 },
                scoreDisplay: playerCard.querySelector('.score'),
                questionDisplay: playerCard.querySelector('.question'),
                answerInput: playerCard.querySelector('.answer-input'),
                keyboardButtons: playerCard.querySelectorAll('.keyboard-button'),
                submitButton: playerCard.querySelector('.submit-button')
            });
        }

        /**
         * 生成随机乘法题目 (1-10 之间)
         * @returns {object} 包含 num1, num2 和正确答案的对象
         */
        function generateQuestion() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            return { num1, num2, answer: num1 * num2 };
        }

        /**
         * 更新玩家 UI (分数和题目)
         * @param {object} player 玩家对象
         */
        function updatePlayerUI(player) {
            player.scoreDisplay.textContent = `分数: ${player.score}`;
            player.questionDisplay.textContent = `${player.question.num1} x ${player.question.num2} =`;
            player.answerInput.value = ''; // 清空输入框
        }

        /**
         * 处理虚拟键盘输入
         * @param {object} player 玩家对象
         * @param {string} value 按钮值 (数字或操作)
         */
        function handleKeyboardInput(player, value) {
            if (!gameActive) return; // 游戏未开始或已结束时禁用输入

            const input = player.answerInput;
            if (value === 'backspace') {
                input.value = input.value.slice(0, -1);
            } else if (value === 'clear') {
                input.value = '';
            } else {
                // 限制输入长度，防止过长
                if (input.value.length < 3) { // 乘法结果最大 10x10=100 (3位)
                    input.value += value;
                }
            }
        }

        /**
         * 提交答案并检查
         * @param {object} player 玩家对象
         */
        function submitAnswer(player) {
            if (!gameActive) return; // 游戏未开始或已结束时禁用提交

            const userAnswer = parseInt(player.answerInput.value, 10);
            const isCorrect = userAnswer === player.question.answer;

            // 视觉反馈
            const playerCardElement = document.getElementById(player.id);
            if (isCorrect) {
                player.score++;
                playerCardElement.classList.add('correct-feedback');
            } else {
                playerCardElement.classList.add('wrong-feedback');
            }

            // 移除反馈类
            setTimeout(() => {
                playerCardElement.classList.remove('correct-feedback', 'wrong-feedback');
            }, 300); // 0.3秒后移除

            // 生成新题目并更新 UI
            player.question = generateQuestion();
            updatePlayerUI(player);
        }

        /**
         * 更新倒计时显示
         */
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        /**
         * 开始倒计时
         */
        function startCountdown() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        /**
         * 初始化游戏状态
         */
        function initializeGame() {
            gameActive = false;
            timeLeft = 120; // 重置为 2 分钟
            updateTimerDisplay();
            startGameBtn.disabled = false; // 启用开始按钮

            players.forEach(player => {
                player.score = 0;
                player.question = generateQuestion(); // 初始题目
                updatePlayerUI(player);
                player.answerInput.value = '';
                player.answerInput.disabled = true; // 默认禁用输入
                player.submitButton.disabled = true; // 默认禁用提交
                player.keyboardButtons.forEach(button => button.disabled = true); // 默认禁用键盘
            });

            // 隐藏模态框
            gameOverModal.classList.remove('show');
        }

        /**
         * 开始新游戏
         */
        function startGame() {
            if (gameActive) return; // 防止重复开始

            gameActive = true;
            startGameBtn.disabled = true; // 禁用开始按钮
            timeLeft = 120; // 确保从 2 分钟开始
            updateTimerDisplay();
            startCountdown();

            // 启用所有玩家的输入和键盘
            players.forEach(player => {
                player.answerInput.disabled = false;
                player.submitButton.disabled = false;
                player.keyboardButtons.forEach(button => button.disabled = false);
                player.question = generateQuestion(); // 生成第一道题目
                updatePlayerUI(player);
            });

            // 播放背景音乐
            if (backgroundMusic.paused) {
                backgroundMusic.play().catch(e => console.error("音乐播放失败:", e));
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            }
            gameOverModal.classList.remove('show'); // 确保隐藏模态框
        }

        /**
         * 结束游戏
         */
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            startGameBtn.disabled = false; // 重新启用开始按钮

            // 禁用所有玩家的输入和键盘
            players.forEach(player => {
                player.answerInput.disabled = true;
                player.submitButton.disabled = true;
                player.keyboardButtons.forEach(button => button.disabled = true);
            });

            // 暂停音乐
            backgroundMusic.pause();
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');

            // 确定赢家
            let maxScore = -1;
            players.forEach(player => {
                if (player.score > maxScore) {
                    maxScore = player.score;
                }
            });

            const winners = players.filter(player => player.score === maxScore);
            let message = '';
            if (winners.length === 1) {
                message = `${winners[0].id.replace('player', '玩家 ')} 获胜，得分 ${maxScore}！`;
            } else {
                const winnerNames = winners.map(player => player.id.replace('player', '玩家 ')).join(' 和 ');
                message = `${winnerNames} 平局获胜，得分 ${maxScore}！`;
            }

            modalMessage.textContent = message;
            gameOverModal.classList.add('show'); // 显示游戏结束弹窗
        }

        // 事件监听器
        startGameBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', initializeGame); // 点击“再玩一次”时初始化游戏

        // 为每个玩家的键盘和提交按钮添加事件监听器
        players.forEach(player => {
            player.keyboardButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const value = button.dataset.value;
                    const action = button.dataset.action;
                    handleKeyboardInput(player, value || action);
                });
            });
            player.submitButton.addEventListener('click', () => submitAnswer(player));
            // 允许按回车键提交答案
            player.answerInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    submitAnswer(player);
                }
            });
        });

        // 音频控制事件监听器
        playPauseBtn.addEventListener('click', () => {
            if (backgroundMusic.paused) {
                backgroundMusic.play().catch(e => console.error("音乐播放失败:", e));
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            } else {
                backgroundMusic.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
            }
        });

        volumeSlider.addEventListener('input', (event) => {
            backgroundMusic.volume = event.target.value;
        });

        // 页面加载完成时初始化游戏
        window.onload = initializeGame;
    </script>
</body>
</html>
